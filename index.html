<!DOCTYPE html>
<html><head>
<meta http-equiv="Content-Type" content="text/html"; charset="utf8"></meta>
<meta name="author" content="Tobi Turing">
<meta name="version" content="0.2beta">
<meta name="date" content="2013-09-03">
<meta name="keywords" content="Cellular, Automata, Wave, Generator, Greenberg-Hastings Cellular Automaton">
<title class="item">Cellular Automaton - Wave Generator</title>
<script type='text/javascript' src='jquery-2.0.3.js'></script>
<!-- http://en.wikipedia.org/wiki/Greenberg-Hastings_cellular_automaton -->
<!--<script type='text/javascript' src='jcanvas.min.js'></script>-->
</head>
<body style="font-family:helvetica">
<div>
<canvas id="c" style="border:1px dotted;float:left" ></canvas>
<input type="button" value="next cycle" onclick=next_cycle();></input>
<input type="button" value="checkerboard" onclick=checkerboard();></input>
<input type="button" value="reset" onclick=reset_canvas();></input>
<br/>
<select id="detail" type="list" list="detail_list" onchange=reset_canvas();>
<datalist id="detail_list">
  <option>1</option>
  <option>2</option>
  <option>3</option>
  <option>4</option>
  <option selected>5</option>
  <option>6</option>
  <option>7</option>
</datalist>
</select>
<label for="detail">detail</label>
</div>
<div>
  cycle<p id='cycle'>&nbsp;</p>
  mouse<p id='mouse_pos'>&nbsp;</p>
  grid<p id='grid_pos'>&nbsp;</p>  
</div>
<script type='text/javascript' src='grid.js'></script>
<script type='text/javascript'>

"use strict";

function next_cycle(){
  var verbose = false;
  update_cycleview(++cycle);
  var size = matrix.size;
  log_matrix(matrix.data);
  var last_matrix = [];
  for(var x=0; x<size; x++){
      last_matrix.push(matrix.data[x].slice());
  }
  for(var y=0; y<size; y++){  
    for(var x=0; x<size; x++){
      var x_left = (x-1<0) && size-1 || x-1;
      var x_right = (x+1)%(size);
      var y_top = (y-1<0) && size-1 || y-1;
      var y_bottom = (y+1)%(size);
      var left = parseInt(last_matrix[x_left][y]);
      var right = parseInt(last_matrix[x_right][y]);
      var top = parseInt(last_matrix[x][y_top]);
      var bottom = parseInt(last_matrix[x][y_bottom]);
      var result;
      //rule 1 and 2
      if(last_matrix[x][y] == 1 || last_matrix[x][y] == 2) { 
        pixel(x,y);
        if(verbose) result = (last_matrix[x][y] + 1 )%3;
      } else if(last_matrix[x][y] == 0) { //rule 3
        if(left == 1 || right == 1 || top == 1 || bottom == 1) {
          pixel(x,y);
          if(verbose) result = (last_matrix[x][y] + 1 )%3;
        } else if(left == 0 && right == 0 && top == 0 && bottom == 0){
          // do nothing
          if(verbose) result = (last_matrix[x][y] )%3;
        } else { if(verbose) var result = (last_matrix[x][y] )%3; }
      }
      if(verbose){
        console.log('['+x+']['+y+']');
        console.log('  '+top);
        console.log(left+' '+last_matrix[x][y]+' '+right+'  => '+result);
        console.log('  '+bottom);
      }
    }
  }
  log_matrix(last_matrix);
  log_matrix(matrix.data);
}

function reset_canvas(){
  c.canvas.width++;
  c.canvas.width--;
  init_grid();
  cycle = 0;
  update_cycleview(cycle);
}

function main(){
}

$('canvas').click(function(e){
  var x = e.pageX - this.offsetLeft;
  var y = e.pageY - this.offsetTop;
  $('#mouse_pos').html(x + ', ' + y);
  var g_x = Math.floor( x / grid.pixel );
  var g_y = Math.floor( y / grid.pixel );
  pixel(g_x,g_y);
  $('#grid_pos').html(g_x + ', ' + g_y);
  log_matrix(matrix.data);
});

main();
</script>
</body></html>
