<style>
ul {
  max-width: 220px;
  list-style: none;
  float: left;
}

li {
  float: right;
  width: 220px;
  padding-bottom: 5px;
}
</style>

<ul>
  <li>
    <DetailControl
      ref:detail
      scaling="{{ scaling }}"
      on:select="selections()"/>
  </li>
  <li>
    <AlgorithmControls
      ref:algorithm
      algorithms="{{ algorithms }}"
      on:select="selections()"/>
  </li>
  <li>
    <State
      ref:state
      states="{{ states }}"
      on:select="selections()"/>
  </li>
</ul>
{{#if selected}}
<ul>
  <li>{{ selected.detail }}</li>
  <li>{{ selected.algorithm }}</li>
  <li>{{ selected.neighborhood }}</li>
  <li>{{ selected.radius }}</li>
  <li>{{ selected.state }}</li>
</ul>
{{/if}}
<script>
import settings from './settings.js'
import states from './states.js'

import DetailControl from './DetailControl.html'
import AlgorithmControls from './AlgorithmControls.html'
import State from './State.html'

var details = []
for (var i = 1; i <= settings.detail.max; i++) {
  details.push(i)
}

export default {
  data () {
    return {
      scaling: details,
      states: states,
      settings: settings,
      selected: []
    }
  },

  computed: {
    neighbors: (selected, algorithms) => {
      var nb = []
      if (selected && selected.algorithm) {
        nb = Array
        .from(Array
          .from(algorithms)
          .find((a) => a.key === selected.algorithm).neighborhood)
        .map((o) => o.type)
      } else {
        selected.radius = ''
      }
      return nb
    },
    radii: (selected, neighbors, algorithms) => {
      var r = []
      if (selected && selected.algorithm && selected.neighborhood) {
        let rd = Array
          .from(algorithms)
          .find((a) => a.key === selected.algorithm).neighborhood
        let nb = Array
        .from(rd).find((o) => o.type === selected.neighborhood)
        if (nb) { r = nb.radius }
      }
      return r
    }
  },

  components: {
    DetailControl,
    AlgorithmControls,
    State
  },

  helpers: {

  },

  methods: {
    selections () {
      let selections = [ 'detail', 'algorithm', 'neighborhood', 'radius', 'state' ]
      var s = {}
      Array
      .from(selections)
      .map((name) => {
        if (this.refs[name].refs[name]) {
          var selected = Array.from(this.refs[name].refs[name]).find((s) => s.selected)
          s[name] = (selected) ? selected.value : ''
        }
      })
      this.set(
        {
          selected: s
        }
      )
    }
  }
}
</script>
